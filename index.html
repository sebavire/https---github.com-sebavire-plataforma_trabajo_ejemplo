<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Usuarios Registrados</title>
    <link rel="stylesheet" href="estilo.css" />
  </head>

  <body>
    <div class="encabezado">
      <div id="usuarioNombre" class="usuario_logueado"></div>
      <a href="registro_usuario.html" id="botonRegistro" class="boton_registro"
        >Registrarse</a
      >
      <a href="login.html" id="botonlogin" class="boton_registro"
        >Iniciar Sesión</a
      >
    </div>

    <h2>Página de Inicio</h2>
    <div class="contenedor" id="contenedorUsuarios"></div>

    <!-- Modal -->
    <div id="modalUsuario" class="modal">
      <div class="modal-contenido">
        <span class="cerrar">&times;</span>
        <h3>Detalle del Usuario</h3>
        <p><strong>ID:</strong> <span id="modalId"></span></p>
        <p><strong>Nombre:</strong> <span id="modalNombre"></span></p>
        <p><strong>Password:</strong> <span id="modalPassword"></span></p>
      </div>
    </div>

    <script>
      const nombreUsuario = sessionStorage.getItem("usuario");
      const botonRegistro = document.getElementById("botonRegistro");
      const usuarioNombre = document.getElementById("usuarioNombre");

      // Manejo de sesión
      if (nombreUsuario) {
        usuarioNombre.textContent = "Bienvenido, " + nombreUsuario;

        // Cambiar botón a "Cerrar sesión"
        botonRegistro.style.display = "none";
        botonlogin.textContent = "Cerrar sesión";
        botonlogin.href = "#";

        botonlogin.addEventListener("click", function (e) {
          e.preventDefault();
          sessionStorage.removeItem("usuario"); // cerrar sesión
          window.location.reload(); // recargar para mostrar botón "Registrarse"
        });
      }

      // Listar usuarios
      fetch("usuario_api.php?accion=listar")
        .then((res) => res.json())
        .then((data) => {
          const contenedor = document.getElementById("contenedorUsuarios");
          contenedor.innerHTML = ""; // limpiar contenedor
          data.forEach((usuario) => {
            const div = document.createElement("div");
            div.className = "card";
            div.innerHTML = `<h3>${usuario.nombre}</h3>
                    <p>ID: ${usuario.id}</p>
                    <button class="boton-vermas" data-id="${usuario.id}">Ver más</button>`;
            contenedor.appendChild(div);
          });

          // Agregar event listeners a los botones
          document.querySelectorAll(".boton-vermas").forEach((boton) => {
            boton.addEventListener("click", function () {
              const userId = this.getAttribute("data-id");
              cargarDetallesUsuario(userId);
            });
          });
        })
        .catch((err) => console.error("Error:", err));

      /*Funciones del modal de detalle usuario*/
      function cargarDetallesUsuario(userId) {
        fetch("usuario_api.php?accion=detalle&id=" + userId)
          .then((res) => res.json())
          .then((usuario) => {
            document.getElementById("modalId").textContent = usuario.id;
            document.getElementById("modalNombre").textContent = usuario.nombre;
            document.getElementById("modalPassword").textContent =
              usuario.password;

            // Mostrar modal
            document.getElementById("modalUsuario").style.display = "block";
          })
          .catch((err) => console.error("Error:", err));
      }

      // Cerrar modal
      document.addEventListener("DOMContentLoaded", () => {
        const modal = document.getElementById("modalUsuario");
        const spanCerrar = document.querySelector(".cerrar");

        spanCerrar.onclick = () => (modal.style.display = "none");
        window.onclick = (e) => {
          if (e.target == modal) modal.style.display = "none";
        };
      });
    </script>
  </body>
</html>
